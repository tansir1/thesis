%\chapter{UAV Model}
\section{UAV Model}
Each UAV within the simulation is a self contained entity capable of acting and thinking on its own accord.  No UAV requires the presence of any other UAV or the aid of any external actor.  The swarm is made of multiple independent UAVs that share information and in doing so coordinate actions to complete the mission.  The simulation supports an arbitrary number of user defined UAV types (or platforms) with unique payloads.  Payload configurations for this work are shown in section~\ref{sec:pyldConfigs}.


%\section{UAV Kinematics}
\subsection{UAV Kinematics}
Each UAV type has a fixed speed and turning radius.  The fixed speed represents the aircraft's standard cruising speed that it will maintain throughout the simulation.  An example set of UAV type kinematic configuration data is shown in table~\ref{tab:uavKinematic}.

\begin{table}[H]
	\caption{UAV kinematic definitions}
	\centering
	\rowcolors{1}{lightgray}{white}
	\label{tab:uavKinematic}
	\begin{tabular}{|p{1cm}|p{2cm}|p{1cm}|}
		\hline
		UAV Type & Turning Radius (m) & Speed ($\frac{m}{s}$)\\ \hline
		0 & 150 & 100 \\
		1 & 300 & 60 \\
		\hline
	\end{tabular}
\end{table}

UAVs know their current 2D coordinate and heading.  This information is used to compute a path to any destination location and orientation.  In formal mathematics terms the kinematic model of a UAV is defined as \dots

\begin{align}
\dot{x} &= v \cos(\psi) \label{eq:uavChngX}\\
\dot{y} &= v \sin(\psi) \label{eq:uavChngY}\\
\dot{\psi} &= \{-constant, 0, constant\} \label{eq:uavTurnRate}\\
\dot{v} &= 0 \label{eq:uavAccel}\\
\psi_{constant} &= \frac{v*\sin(\pi)}{r} \label{eq:uavTurnRateDeriv}
\end{align}

\dots where $x$ and $y$ represent the UAV's current position on a Cartesian plane, $v$ is the UAV's fixed speed, $\psi$ is the UAV's heading, and $r$ is the UAV's turning radius.  Equations~\ref{eq:uavChngX} and \ref{eq:uavChngY} enforce that a UAV's position changes relative to its speed on a continuous trajectory.  Equation~\ref{eq:uavTurnRate} forces the UAVs to always turn at a known rate or not at all.  This allows for simplified trajectory planning using the equations for Dubin's Curves described in \cite{dubins}.  Equation~\ref{eq:uavAccel} states that the UAVs move at a constant speed.  The constant for the turn rate is computed as shown in equation~\ref{eq:uavTurnRateDeriv}.  The world's terrain is modeled as a flat bald Earth.










\chapter{MOVE THIS}

When the simulation starts the UAVs begin searching the world for targets.  While scanning the world they update their internal belief model.  This internal model is shared with other members of the swarm when they are within communication's range of each other.  This model contains data regarding each UAV's confidence that a geographic region is clear and a list of known targets.  Chapter~\ref{sec:uavBelief} describes this model in detail.

When a target is found the UAV assigns an initial task status to the target and announces the discovery of the target.  The original UAV and anyone within communication's range compute a scoring value to determine who is the most appropriate UAV to monitor or attack the target.  Soon after the other UAVs in range who heard the initial target announcement will re-broadcast their internal belief models, and therefore propagate the target discovery throughout the swarm.

\section{UAV Communications}
While each agent within the swarm is capable of self actualization, mission performance improves when the agents work as a team.  To work as a team the UAVs must communicate with each other.  The simulation done in this work limits the communication range of UAV's to a percentage of the maximum world distance.  Given that the mission occurs in a square or rectangular environment, the maximum world distance occurs between opposite corners along a diagonal that bisects the mission area.  By specifying the communication range as a percentage of the world size the algorithms in this work are invariant of the physical world's size.

From a communication perspective the swarm can be thought of as a mobile ad hoc network (sometimes referred to as a MANET).  This is because the network connections among the UAVs is dynamic and unpredictable.  There are no designated network control nodes.  Every UAV is equally likely to broadcast spontaneously.  A simple approach to make sure all agents within the swarm receive all communications is to ``flood'' the broadcasts.  When an agent hears a particular message for the first time it is required to rebroadcast the message.  The advantage to this simple approach is that it requires no coordination or management overhead for communications support within the swarm.

While simple to implement this flooding approach has many drawbacks.  Many neighboring UAVs will likely have already heard the message themselves from the original source meaning there are redundant broadcasts.  Many neighboring UAVs will hear the message simultaneously and will jam each other when they all attempt to rebroadcast the message.  When the message collisions occur the data transmissions will be garbled forcing a re-transmission that further adds to the network congestion.  This is known as the broadcast storm problem as originally put forth by~\cite{bstorm}.

Finding ways to optimize MANETs and to eliminate the broadcast swarm problem is a whole field of research unto itself.  The research performed in~\cite{epidemicManets} and ~\cite{analysisOptNodeDen} are relevant to UAV swarms in that they find ways to minimize the number of needed transmissions and ways to reduce transmission power levels.  The standard approach is to not always rebroadcast a message when it is first heard and instead only rebroadcast based on chance.  This is known as the Probabilistic Flooding technique.  There are many variants to this technique with some described in~\cite{probFloodVariants}.  For our purposes the version described in~\cite{simpleProbFlood} was used.  In this case the probability that a UAV will rebroadcast any individual message is computed by equation~\ref{eq:probFlood} where $hop$ is the number of times the message has already been rebroadcasted and $num\_uavs$ is the number of UAVs in the swarm.  This equation states that when a message is first generated it is very likely it will be rebroadcasted but each subsequent broadcast becomes less likely to occur.

\textbf{I would be useful to summarize any results from Jiang that would indicate that this is a good strategy and how well it performed. Also this whole discussion about MANETS assume that there is connectivity throughout the network. This will mean that eventually all UAVs should hear all broadcasts. It also means that if a UAV or group of UAVs is totally isolated from the rest of the swarm that any information it (or they) broadcast is lost to the rest of the swarm. This appears the case in Figure 7-1 later where most of the UAVs are isolated from each other. The impact this has on performance is an important aspect of this approach and I would think you should complete the discussion here about how communication works in those cases.	What happens when you hear old news (i.e. a rebroadcast over multiple hops that arrives so late you’ve already heard a more recent version of that message from the sender)?}

\begin{equation}
\label{eq:probFlood}
P(rebroadcast) = 1 - \frac{hop}{num\_uavs - 1}
\end{equation}

\section{UAV Tasks}
UAV's compete to selectively perform tasks in order to complete the mission.  The available tasks are \textit{Search}, \textit{Monitor}, and \textit{Attack}.  The Search task is always available for all UAVs to carry out.  The Monitor and Attack tasks can only be executed in association with a suspected or confirmed target respectively.
%\textbf{TODO: Explain assignment states here?}

\subsection{Search}
No target locations within the simulated world are known \textit{a priori}.  The UAV's must discover all targets individually.  The goal of searching is for the swarm to map out the locations of targets and maintain a roving surveillance presence. In formal terms Search is guided by the confidence or certainty of the swarm that a location contains or does not contain targets.  Over time this certainty erodes in locations that are not being actively watched.  UAVs that are performing Search will attempt to maximize their certainty of the world by scanning the most uncertain or least confident locations.  Uncertainty is defined in detail in chapter~\ref{sec:uavBelief}.

A search-and-track survey paper by ~\cite{senanayake} highlights many search algorithms to choose from. Our search was accomplished by mimicking the foraging behaviors of animals with an algorithm similar in principle to a \textit{L\'evy Flight} (\cite{humphries}) but adapted to a discrete world instead of a continuous world.  The L\'evy Flight algorithm is a type of biased random walk.  The UAV foraging algorithm is enumerated in algorithm~\ref{alg:forage} in appendix~\ref{sec:algorithms}.  The algorithm will randomly select a grid cell within the world or it will divide the world into kernels, compute the uncertainty of each kernel, and randomly select a cell within the most uncertain kernel.  The kernel size must divide equally into the number of rows and columns in the world. 

\textbf{TODO: IN reference to "within the most uncertain kernel"
	This worries me. The mantra of swarming systems is to sense and act locally. Here you are sensing and acting globally since you take the most uncertain kernel. I can see two issues that I don’t know whether you address later:
	If your communications range is short enough, I suspect you may not hear about distant UAV activities. Since the only way to reduce uncertainty in a cell is through UAV activity, the most uncertain cells will be those most distant from me that I haven’t heard anything about. I may then be inclined to select a move to a distant region only because I didn’t hear about the fact that they had already been searched. 
	Since all UAVs are looking for the highest uncertainty kernel what is to prevent them from all selecting the same kernel to move towards leading to herding behavior? } 

%https://en.wikipedia.org/wiki/L%C3%A9vy_flight

Once a search cell has been selected the UAV will fly towards it until another task takes precedence or the uncertainty in the cell falls below a user configured threshold.  The uncertainty in the cell changes when the UAV's sensors can reach it or when an update from another UAV in the swarm provides new data about the cell. If the uncertainty in the cell drops below the user configured threshold then the UAV will select a new cell to investigate.  Given that the UAV is within the most uncertain kernel when the selected cell becomes certain it will very likely search another nearby cell. \textbf{TODO: In reference: "it will very likely search another nearby cell" Actually, as I understand it, the algorithm will select a cell at random in the kernel and move its sensor there, which won’t “very likely” be a nearby cell. }  Typically the UAV will search neighboring cells until the local kernel becomes more certain than other kernels in the world.  An atypical case occurs when the UAV selects a completely random location in the world.  The weighting between searching a kernel area versus random world locations is controlled by the $randomWeighting$ parameter in algorithm~\ref{alg:forage}.

While performing the search task UAVs point their sensor payloads towards the selected search cell even if they are not within range.  While traversing the world the UAV will opportunistically scan all cells encompassed by the sensor's field of view.


\subsection{Monitor}
The Monitor task requires a UAV to watch a potential target.  The UAV will point its sensing payloads at the target, confirm the target's identity, track the target, and perform a battle damage assessment after the target has been struck.  These steps are broken down into states within the Monitor task.  The monitor task state transitions are illustrated in figure~\ref{fig:monitor}.

\subsubsection{En Route}
When a UAV first starts the Monitor task it begins flying towards the target and points its payloads in the target's direction.  As the UAV flies it continues to scan any cell within its payload's field of view until the target is within range.  Once the target is in sensor range the UAV transitions to the Confirm state.  

When the UAV is in sensor range it will begin orbiting the target.  If the target moves more than some user configurable percentage of the sensor's range then the UAV will adjust its flight path and recenter the orbit over the target's new location.

\end{multicols*}

\begin{figure}[H]
	\centering
	%\includegraphics[width=\linewidth,height=\textheight]{imagefile}
	\includegraphics[scale=0.6]{uav_monitor_states.png}
	%	\includegraphics{uav_monitor_states.png}
	\caption{Monitor sub-states}
	\label{fig:monitor}
\end{figure}

\begin{multicols*}{2}

\subsubsection{Confirm}
When the target is within sensor range the UAV will focus its sensors on the target.  This causes the sensors to stop performing a wide area scan and to zoom in on the target's suspected world cell location.  At this time the UAV is analyzing the sensor data to determine if the suspected target is a real target or if it's a false positive and no target exists.  No other targets can be detected during this focused scan and the certainty of any cells that happen to be in the field of view do not change.  If the suspected target is fake then the UAV exits the Monitor task.  If the target is confirmed to be real then the UAV transitions to the Track Target state.  For purposes of this experiment the target confirmation analysis process was assumed to take 10 seconds.  No attempt was made to model real world physics of target identification from raw sensor data.

\subsubsection{Track Target}
In this state the UAV is continuing to point its payloads at the target but the sensors have resumed a wide area scan in hopes of finding other nearby targets.  The UAV stays in this state until the target outruns the UAV's sensors and is lost, the target is struck by a weapon, or a user configurable timeout occurs.  When the UAV first enters this state it requests a weapon's strike on the target from the swarm.  The details of the weapon's strike request are presented in chapter~\ref{sec:uavBelief}.  The timeout is useful in the cases where all nearby UAVs are busy performing other high priority tasks or are also stuck waiting for a weapon strike.  This timeout acts as a tie breaker to prevent everyone waiting for a strike simultaneously.  The downside is that the target is briefly ignored when the timeout engages.

\subsubsection{Battle Damage Assessment}
When the monitoring UAV detects a weapon's strike on the target it will transition from wide area scan tracking to narrow focused scans of the target's location.  As in the Confirm state during this focused scan no other targets can be detected and the certainty any cells that happen to be in the field of view do not change.  This state represents the time it takes for the UAV to analyze its sensor data to determine if the target was destroyed or if it is still active.  Again, for purposes of the experiment it was assumed that battle damage assessment (BDA) takes 10 seconds to complete.  No attempt was made to model real world physics of target status from raw sensor data.

If the target is still active after the weapon's strike the UAV will transition back to the Track Target state and request another strike from the swarm.  If the target was destroyed then the UAV will exit the Monitor task.


\subsection{Attack}
The Attack task mechanics are similar to the Monitor task in that the UAV will fly towards the target and point all of its sensors at the target.  The UAV will plot a course such that its heading is aligned with the best attack angle relative to the heading of the target.  The UAV will re-plot a new course if the target moves a significant distance.  This distance is user configurable.  The UAV will wait until the distance to the target is below some percentage of the weapon's max range before firing.  For purposes of this experiment the percentage was set to 80\%.  An activity diagram describing the process is shown in figure~\ref{fig:uavAttackActivity}.  In parallel to the actions shown in the diagram the UAV is constantly flying along the last computed Dubin's Path.

The weapon time-of-flight is not modeled.  Weapon strikes are considered instantaneous.  When the weapon is deployed the UAV has completed the task.  The UAV may assign itself a new task and begin maneuvering to a new destination.  However, the UAV performing the Monitor task may request another weapon strike from the swarm if the target was not destroyed.  Therefore the UAV that completed the Attack task might decide to perform the Attack task again since it's likely the closest strike platform available.  The details of this process are explained in chapter~\ref{sec:uavBelief}.  A summary of the interactions between the monitor and attack roles can be seen in figure~\ref{fig:monitorAttacKSequence}.

\end{multicols*}

\begin{figure}[H]
	\centering
	%\includegraphics[width=\linewidth,height=\textheight]{imagefile}
	\includegraphics[scale=0.75]{uav_activity_attack.png}
	\caption{UAV Attack Activity}
	\label{fig:uavAttackActivity}
\end{figure}

\begin{figure}[H]
	\centering
	%\includegraphics[width=\linewidth,height=\textheight]{imagefile}
	\includegraphics[scale=0.75]{monitor_attack_sequence.png}
	\caption{Monitor and Attack Sequence Interactions}
	\label{fig:monitorAttacKSequence}
\end{figure}

\newpage
\clearpage

\begin{multicols*}{2}


